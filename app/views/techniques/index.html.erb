<div class="controls">
  <h1 class="controls__heading">
    Techniques
  </h1>

  <div class="controls__container">
    <%= link_to "+", new_technique_path, class: "button" %>
  </div>
</div>

<%= render "grouping_select" if @techniques.present? %>

<% cache [current_user, (params[:group_by] || @default_grouping), "techniques"] do %>
  <div class="techniques">
    <% if @techniques.present? %>
      <% @techniques.each do |first_group_name, second_group| %>
        <div>
          <h1><%= first_group_name %></h1>

          <% second_group.each do |second_group_name, techniques| %>
            <div>
              <h2><a href="#" class="toggle-techniques icon-arrow-right-after"><%= second_group_name %></a></h2>
              <a class="peek__link--all icon-eye" href="#">
                <span class="screen-reader-text">
                  Peek all
                </span>
              </a>

              <ul>
                <% techniques.each do |technique| %>
                  <li>
                    <%= link_to technique.name, technique, class: "technique__link" %>

                    <a class="peek__link icon-eye" data-technique-id="<%= technique.id %>" href="#">
                      <span class="screen-reader-text">
                        Peek
                      </span>
                    </a>

                    <% if technique.notes_count > 0 %>
                      <span class="note-count">
                        (<%= pluralize(technique.notes_count, "note") %>)
                      </span>
                    <% end %>

                    <div class="technique__description">
                      <%= simple_format technique.description %>
                    </div>
                  </li>
                <% end %>
              </ul>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      You have no techniques yet
    <% end %>
  </div>
<% end %>
